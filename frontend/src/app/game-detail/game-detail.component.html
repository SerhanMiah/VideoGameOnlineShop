<div class="container-fluid game-detail-container mx-auto mt-12" *ngIf="selectedGame">

    <header class="game-detail-header row">
        <h1 class="col-12 game-title text-4xl font-semibold mb-6">{{ selectedGame.title }}</h1>
    </header>
    <div class="col-12 mx-auto trailer-section">
        <div class="card border-0 shadow-lg">
            <div class="card-header bg-dark text-white">
                <h2 class="m-0">Official Trailer</h2>
            </div>
            <div class="card-body p-0">
                <div class="embed-responsive embed-responsive-16by9">
                    <iframe class="embed-responsive-item" [src]="selectedGame.trailerUrl ? getSafeUrl(selectedGame.trailerUrl) : ''" allowfullscreen></iframe>
                </div>
            </div>
        </div>
    </div>
    
    <section class="game-media row mb-5">
        <div id="gameImagesCarousel" class="carousel slide" data-ride="carousel">
            <ol class="carousel-indicators">
            <li data-target="#gameImagesCarousel" [attr.data-slide-to]="0" class="active"></li>
            <li *ngFor="let image of selectedGame.gameImages; let i = index" data-target="#gameImagesCarousel" [attr.data-slide-to]="i + 1"></li>
          </ol>
          <div class="carousel-inner">
            <!-- Main Cover Image -->
            <div class="carousel-item active">
              <img [src]="selectedGame.coverImage" alt="{{ selectedGame.title }} cover image" class="img-fluid rounded">
            </div>
            <!-- Additional Game Images -->
            <div *ngFor="let image of selectedGame.gameImages; let i = index" class="carousel-item">
              <img [src]="image.url" alt="Game Image" class="img-fluid rounded">
            </div>
          </div>
          <a class="carousel-control-prev" href="#gameImagesCarousel" role="button" data-slide="prev" (click)="prevImage()">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="sr-only">Previous</span>
          </a>
          <a class="carousel-control-next" href="#gameImagesCarousel" role="button" data-slide="next" (click)="nextImage()">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="sr-only">Next</span>
          </a>
        </div>
      </section>
      
    

    <section class="game-info row mb-12">
        <div class="col-md-6 details-section">
            <p><strong>Developer:</strong> {{ selectedGame.developer }}</p>
            <div class="price-badge text-red-600">{{ selectedGame.price | currency }}</div>
            <div class="quantity-container flex items-center">
                <label for="game-quantity">Quantity:</label>
                <input id="game-quantity" [(ngModel)]="selectedQuantity" type="number" min="1" class="p-2 border rounded-md w-20 text-center"/>
            </div>
            <div class="total-price">
                <strong>Total Price:</strong> {{ selectedGame.price * selectedQuantity | currency }}
            </div>
            <div class="buttons-group space-y-3">
                <button (click)="addToCart(selectedGame.id, selectedQuantity)" class="btn btn-primary"><i class="fa fa-shopping-cart"></i> Add to Cart</button>
                <button (click)="directPurchase(selectedGame.id, selectedQuantity)" class="btn btn-success"><i class="fa fa-credit-card"></i> Buy Now</button>
            </div>
            <div class="release-info">
                <p><strong>Release Date:</strong> {{ selectedGame.releaseDate | date }}</p>
                <h4>System Requirements:</h4>
                <p><strong>Minimum:</strong> {{ selectedGame.minimumSystemRequirements }}</p>
                <p><strong>Recommended:</strong> {{ selectedGame.recommendedSystemRequirements }}</p>
            </div>
        </div>

        <div class="col-md-6 tab-section">
            <ul class="nav nav-tabs">
                <li class="nav-item">
                    <a class="nav-link active" id="description-tab" data-toggle="tab" href="#description">Description</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="details-tab" data-toggle="tab" href="#details">Details</a>
                </li>
            </ul>
            <div class="tab-content">
                <div class="tab-pane fade show active" id="description">
                    <p>{{ selectedGame.description }}</p>
                </div>
                <div class="tab-pane fade" id="details">
                    <p><strong>Trailer:</strong> <a [href]="selectedGame.trailerUrl" target="_blank">Watch here</a></p>
                </div>
            </div>
        </div>
    </section>

    <section class="dlc-section row mb-12">
        <h2 class="col-12 mb-4">DLCs & Additional Content</h2>
        <div *ngIf="selectedGame.dlcs?.length; else noDLCs">
            <div class="col-md-4 dlc-item" *ngFor="let dlc of selectedGame.dlcs">
                <h3>{{ dlc.dlcName }}</h3>
                <p>{{ dlc.description }}</p>
                <div class="dlc-images">
                    <img *ngFor="let image of dlc.dlcImages" [src]="image" alt="{{ dlc.dlcName }} Image" class="img-fluid rounded-lg shadow-md">
                </div>
            </div>
        </div>
        <ng-template #noDLCs>
            <p class="col-12 text-muted">No DLCs available for this game.</p>
        </ng-template>
    </section>

    <section class="reviews row">
        <div class="col-12">
            <h2>Reviews:</h2>
            <app-game-review [gameId]="selectedGame.id"></app-game-review>
        </div>
    </section>

</div>
